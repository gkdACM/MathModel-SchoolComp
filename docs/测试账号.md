# 测试账号（开发环境）

> 说明：以下账号仅用于开发/测试环境，请勿在生产环境使用相同的默认密码。首次部署后可在数据库中修改或通过后台功能重置。

## 管理员
- 账号：`root`
- 密码：`toor`

## 学生
- 学号：`20230001`
- 密码：`123456`
- 邮箱：`stu01@example.com`

## 教师
- 账号：`t001`
- 密码：`123456`
- 邮箱：`tea01@example.com`

## 登录接口
- 管理员专用：`POST /api/auth/adminManager-login`
- 学生专用：`POST /api/auth/student-login`（使用 `studentId` 或 `email`）
- 教师专用：`POST /api/auth/teacher-login`
- 兼容通用：`POST /api/auth/login`（后续建议迁移至分拆接口）

## 响应示例
```json
{
  "code": 0,
  "data": {
    "token": "<jwt>",
    "role": "student|teacher|admin",
    "profile": { /* 基本信息 */ }
  }
}
```

## 登录测试用例

> 目标：使用内置测试账号分别验证管理员、学生、教师登录接口是否正常返回 `code=0` 与合法 JWT。

### 管理员登录用例
- 接口：`POST http://localhost:8080/api/auth/adminManager-login`
- 请求体：
```json
{
  "account": "root",
  "password": "toor"
}
```
- cURL 示例：
```bash
curl -sS -X POST \
  http://localhost:8080/api/auth/adminManager-login \
  -H 'Content-Type: application/json' \
  -d '{"account":"root","password":"toor"}'
```
- 期望成功响应（示例）：
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "token": "<jwt>",
    "role": "admin",
    "profile": { "account": "root", "name": "超级管理员" }
  }
}
```

### 学生登录用例（使用学号）
- 接口：`POST http://localhost:8080/api/auth/student-login`
- 请求体：
```json
{
  "studentId": "20230001",
  "password": "123456"
}
```
- cURL 示例：
```bash
curl -sS -X POST \
  http://localhost:8080/api/auth/student-login \
  -H 'Content-Type: application/json' \
  -d '{"studentId":"20230001","password":"123456"}'
```
- 期望成功响应（示例）：
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "token": "<jwt>",
    "role": "student",
    "profile": { "studentId": "20230001", "name": "学生一号", "email": "stu01@example.com" }
  }
}
```

### 学生登录用例（使用邮箱）
- 接口：`POST http://localhost:8080/api/auth/student-login`
- 请求体：
```json
{
  "email": "stu01@example.com",
  "password": "123456"
}
```
- cURL 示例：
```bash
curl -sS -X POST \
  http://localhost:8080/api/auth/student-login \
  -H 'Content-Type: application/json' \
  -d '{"email":"stu01@example.com","password":"123456"}'
```

### 教师登录用例
- 接口：`POST http://localhost:8080/api/auth/teacher-login`
- 请求体：
```json
{
  "account": "t001",
  "password": "123456"
}
```
- cURL 示例：
```bash
curl -sS -X POST \
  http://localhost:8080/api/auth/teacher-login \
  -H 'Content-Type: application/json' \
  -d '{"account":"t001","password":"123456"}'
```
- 期望成功响应（示例）：
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "token": "<jwt>",
    "role": "teacher",
    "profile": { "account": "t001", "name": "教师一号", "email": "tea01@example.com" }
  }
}
```

### 失败用例示例（密码错误）
- 任一登录接口，密码错误时：
```json
{
  "code": 1002,
  "message": "账号或密码错误"
}
```

### Apifox 测试建议
- 为三个接口分别创建用例，填入上述请求体；设置断言：`code == 0` 且 `data.role` 匹配预期；提取 `data.token` 供后续授权接口使用。

## 注意事项
- 仅在开发环境保留默认测试账号；生产环境应禁用或重置默认密码，并启用更严格的登录风控策略（验证码、速率限制、IP 白名单等）。

---

## 教师批量创建（管理员）测试用例

> 说明：通过管理员接口批量生成教师账号，账号格式为 `tNNN`（如 `t001`、`t002`），默认初始密码为 `Math123@123`。若数据库已存在同名教师，则返回 `status=exists` 且不重复创建（`tempPassword` 为空）。

### 前置：获取管理员令牌
- 接口：`POST http://localhost:8080/api/auth/adminManager-login`
- cURL：
```bash
TOKEN=$(curl -sS -X POST \
  http://localhost:8080/api/auth/adminManager-login \
  -H 'Content-Type: application/json' \
  -d '{"account":"root","password":"toor"}' \
  | jq -r '.data.token')
echo "Admin JWT: ${TOKEN}"
```

---

## 教师密码初始化与导出（管理员）测试用例

> 说明：管理员可一键重置所有教师密码为默认值 `Math123@123`，或按账号列表重置；导出 CSV 时仅显示仍为默认密码的教师项以避免泄露真实密码。

### 前置：获取管理员令牌（复用上文）
```bash
ADMIN_TOKEN=$(curl -sS -X POST \
  http://localhost:8080/api/auth/adminManager-login \
  -H 'Content-Type: application/json' \
  -d '{"account":"root","password":"toor"}' | jq -r '.data.token')
echo "ADMIN_TOKEN=${ADMIN_TOKEN}"
```

### 用例一：一键初始化全部教师密码
```bash
curl -sS -X POST \
  http://localhost:8080/api/admin/teachers/password/init \
  -H "Authorization: Bearer ${ADMIN_TOKEN}" \
  -H 'Content-Type: application/json' \
  -d '{"all": true}' | jq '.'
```
期望：返回 `code=0`，`data.updated` 为已重置数量，`data.defaultPassword` 为 `Math123@123`。

### 用例二：按列表初始化指定教师密码
```bash
curl -sS -X POST \
  http://localhost:8080/api/admin/teachers/password/init \
  -H "Authorization: Bearer ${ADMIN_TOKEN}" \
  -H 'Content-Type: application/json' \
  -d '{"accounts": ["t001", "t002"]}' | jq '.'
```
期望：返回每个账号的处理状态（`ok` 或 `not_found`）。

### 用例三：导出教师密码 CSV（仅默认密码显示）
```bash
curl -sS -X GET \
  http://localhost:8080/api/admin/teachers/password/export \
  -H "Authorization: Bearer ${ADMIN_TOKEN}" \
  -o teachers-passwords.csv && echo '导出完成：teachers-passwords.csv'
```
验证：打开 CSV 文件，应包含表头 `account,name,password`。若某教师仍为默认密码，则 `password` 列为 `Math123@123`，否则为空。

### 用例 1：正常批量创建两个新教师
- 接口：`POST http://localhost:8080/api/admin/teachers/generate`
- Body：`{"names":["张海","李然"]}`
- cURL：
```bash
curl -sS -X POST \
  http://localhost:8080/api/admin/teachers/generate \
  -H "Authorization: Bearer ${TOKEN}" \
  -H 'Content-Type: application/json' \
  -d '{"names":["张海","李然"]}'
```
- 期望响应示例：
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "rows": [
      { "name": "张海", "account": "t002", "tempPassword": "Math123@123", "status": "ok" },
      { "name": "李然", "account": "t003", "tempPassword": "Math123@123", "status": "ok" }
    ],
    "created": 2
  }
}
```
> 注：账号序号按目前数据库内已存在的最大值递增，若已有 `t001`，则下一个为 `t002`。

### 用例 2：包含已存在同名教师
- 已知内置测试教师：`name="教师一号"`，账号 `t001`
- Body：`{"names":["教师一号","王五"]}`
- cURL：
```bash
curl -sS -X POST \
  http://localhost:8080/api/admin/teachers/generate \
  -H "Authorization: Bearer ${TOKEN}" \
  -H 'Content-Type: application/json' \
  -d '{"names":["教师一号","王五"]}'
```
- 期望响应示例：
```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "rows": [
      { "name": "教师一号", "account": "t001", "tempPassword": null, "status": "exists" },
      { "name": "王五", "account": "t004", "tempPassword": "Math123@123", "status": "ok" }
    ],
    "created": 1
  }
}
```

### 用例 3：参数错误（names 为空）
- Body：`{"names":[]}`
- cURL：
```bash
curl -sS -X POST \
  http://localhost:8080/api/admin/teachers/generate \
  -H "Authorization: Bearer ${TOKEN}" \
  -H 'Content-Type: application/json' \
  -d '{"names":[]}'
```
- 期望响应：`HTTP 400`，
```json
{ "code": 1001, "message": "参数校验失败：names 为空" }
```

### 登录验证：使用新账号登录教师端
- 接口：`POST http://localhost:8080/api/auth/teacher-login`
- 示例：使用上一用例中创建的 `t004` 与默认密码 `Math123@123`
```bash
curl -sS -X POST \
  http://localhost:8080/api/auth/teacher-login \
  -H 'Content-Type: application/json' \
  -d '{"account":"t004","password":"Math123@123"}'
```
- 期望响应：`{ code: 0, data: { token, role: "teacher", profile: { account, name, email }}}`